## Visão C4 (PlantUML)

> Diagramas C4 usando PlantUML.

### Nível 1 — Contexto do Sistema

```plantuml
@startuml
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Context.puml

LAYOUT_WITH_LEGEND()

title Contexto do Sistema - Gerenciamento de Estacionamento

Person(operador, "Operador / Consumidor de API", "Usuário que consulta receitas via API REST")
System(backend, "Backend Estapar", "Sistema backend Spring Boot 3 para gerenciamento de estacionamento")
System_Ext(simulador, "Simulador da Garagem", "Simulador que envia eventos de veículos e fornece configuração da garagem")
SystemDb(db, "MySQL 8.x", "Banco de dados relacional para persistência")

Rel(operador, backend, "Consulta receita", "REST API")
Rel(simulador, backend, "Envia eventos", "Webhook POST\n(ENTRY, PARKED, EXIT)")
Rel(backend, simulador, "Busca configuração", "GET /garage")
Rel(backend, db, "Lê e escreve dados", "JPA/Hibernate")

@enduml
```

[Ver imagem](https://www.plantuml.com/plantuml/png/NP5DRjim48NtEiNKAmL8h4MxABgA4mkEMoTMBHbfW086HKra8XIfyiTrZbDqKI10Jw6BbMFBgUCTDPhtyRt7I-kOSRwHqJkXkFGLmjgvrdvA4iD-3clXrhxq5WtNog5oGwwRf9LCaUR2kagAChd-S97HQ7axInfc7PemMbsJOkk6BT6ZsUXXlYnMzzFYPZLB9-dTE3wB8YUSHEWtDLGQSX7q3OCBcA11nGLhKD4lX3HuvKAh_IIACZHMgrYtQ5YbpJaCvlqH4c9QtuZmGT9HDXs4_qlhkrz6QFZX4JXjICV084VXc8MDOBG9YpGl1cTH_anMufBn9rHLa5_jJpiZBJD4FDZjbo1lZL0rN6dju3s49GRrQGvya-FrebMwTR4LZPTzclnmXeh19A1gR0PlvXG35Td63R4iuJVO_ULUXW-4HsqKybtMHr5xmxe_tMzDlBhd7MuVbt5L1lZjS_vr1X-7sy4kiE9aEGYgm3CezyRbFbbesuRytGl52wHeWVBeEVuNTtrIDR6fP6exw8Ai3twYIu-paUWUoxNMJv3Dy-AxYjExOl5m3jbeyIKTdqFwRLgSzRnNo76ZLzvoTb86OITf0Sc-aLFvhfHPzmBqRjpWfY-3P9-pKN8ZIZIAEH96bq7Y6_aF)

### Nível 2 — Contêineres

```plantuml
@startuml
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Container.puml

LAYOUT_WITH_LEGEND()

title Contêineres - Backend Estapar

Person(operador, "Operador", "Usuário que consulta receitas")
System_Ext(simulador, "Simulador da Garagem", "Webhook + GET /garage")

System_Boundary(backend, "Backend Estapar") {
    Container(api, "API REST", "Spring Boot Controllers", "Recebe requisições HTTP e eventos webhook")
    Container(services, "Serviços de Aplicação", "Spring Services", "Lógica de negócio: VehicleService, PricingService, RevenueService, GarageService")
    ContainerDb(db, "MySQL 8.x", "Banco de dados relacional", "Armazena vagas, veículos, receitas e configurações")
}

System_Ext(simulador_ext, "Simulador da Garagem", "Sistema externo que simula eventos de garagem")

Rel(operador, api, "Consulta receita", "GET /revenue")
Rel(simulador_ext, api, "Envia eventos", "POST /webhook\n(ENTRY, PARKED, EXIT)")
Rel(api, services, "Usa")
Rel(services, db, "Lê e escreve", "JPA/Hibernate")
Rel(services, simulador, "Busca configuração", "GET /garage")

@enduml
```

[Ver imagem](https://www.plantuml.com/plantuml/png/VLDFRzfE4BtxKyoF4-YNmAM7AgT0OYLfIKAnQHgf4XhRKxFAikli7vAqweUfUgWKgQUedy1VhBFO84IhSXhllZVlCM_ss3eqpYzbz9zGkVG5mSAvoXuD1WOV-gLm2vzvIoRNof5o_Lml1vL45JY7rXLIP8EJLuUJS3Ix70-MQ1qPFfgVC0E58jElGlzeFBozdgNpculqV3wEp-AhqsulYfnmaY1Ww-S09Wk7CCByZbG1CRkhq4JHX8pLggihCbXeSm2TwxRiS3spllvcX8PxJy16hPSEmL1Emg7jzABaYKqjv_6ZwrgnzBBjaMngA13Eq619oz3lXhA5rdVmFvp5AGpAzGstsVGPQQyAD4_ThF79b3t7dHvyYO1_so5qiHAC6qukO1edQP19AYDK2IEjtHfdj9HaRBYQilUCmD2z5rRKF-fVPE4yJIT0G2lEGLjuQ5nsUdj27DPAv6I30fVCPZ3dEgoao95xVTSxwacB3aVZ-gLaI00hAkkNNEWZU4yBaKjgSGSmCI9dulPx6lpuxNqxn_PptznfrYqoLhfyIjwDuNN_CSYEKEKwY1QSXGL34bbPeGoNGxF4pwGGLbWY_wSLrJzpBpMNcu1X7VedKNg3pQXOzclqrzJdzEZ-aNmY0WM1KMHKir0DTpjszbcs1Dw8AScThMmoFjdRmD1ulKYc6HNpcBRlgU76QYMsMe4ukKwOsMRzKNNZgtHwooaCfs_ZqmE8FroalRRXkiDE-ZEB6wdjOP6jStuEUsJpO2Y8l9aC1-SY8wFGqH-StISpyZR7tN6tsxJtK8v95VpeVmC0)

### Nível 3 — Componentes do Backend

```plantuml
@startuml
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Component.puml

LAYOUT_WITH_LEGEND()

title Componentes - Backend Estapar

System_Ext(simulador, "Simulador da Garagem", "Sistema externo")
Person(operador, "Operador", "Usuário")

System_Boundary(backend, "Backend Estapar") {
    Container_Boundary(api_layer, "API Layer") {
        Component(webhook_controller, "WebhookController", "Spring REST Controller", "Recebe eventos POST /webhook")
        Component(revenue_controller, "RevenueController", "Spring REST Controller", "Endpoint GET /revenue")
    }
    
    Container_Boundary(application_layer, "Application Layer") {
        Component(vehicle_service, "VehicleService", "Spring Service", "Gerencia entrada, estacionamento e saída de veículos")
        Component(pricing_service, "PricingService", "Spring Service", "Calcula preço dinâmico baseado em lotação")
        Component(revenue_service, "RevenueService", "Spring Service", "Consulta faturamento por setor e data")
        Component(garage_service, "GarageService", "Spring Service", "Inicialização e gestão de vagas e setores")
    }
    
    Container_Boundary(infrastructure_layer, "Infrastructure Layer") {
        ComponentDb(repositories, "Repositories JPA", "Spring Data JPA", "Acesso a dados: Spots, Vehicles, Revenues")
        Component(garage_client, "Simulador Client", "HTTP Client", "Cliente HTTP para comunicação com simulador")
    }
    
    ContainerDb(db, "MySQL 8.x", "Banco de dados", "Persistência de dados")
}

Rel(operador, revenue_controller, "Consulta receita", "GET /revenue")
Rel(simulador, webhook_controller, "Envia eventos", "POST /webhook")
Rel(webhook_controller, vehicle_service, "Usa")
Rel(webhook_controller, garage_service, "Usa")
Rel(revenue_controller, revenue_service, "Usa")
Rel(vehicle_service, pricing_service, "Usa")
Rel(vehicle_service, repositories, "Usa")
Rel(vehicle_service, garage_client, "Usa")
Rel(garage_service, repositories, "Usa")
Rel(pricing_service, repositories, "Usa")
Rel(revenue_service, repositories, "Usa")
Rel(repositories, db, "Lê e escreve", "JPA/Hibernate")
Rel(garage_client, simulador, "Busca configuração", "GET /garage")

@enduml
```

[Ver imagem](https://www.plantuml.com/plantuml/png/ZLNDRjj64BxpAQO-oK1iNNeeSeej4xOBfLOjkK5Fmd0vbXPPxXBxerWjyZ1j3m42v2duOfqbQP7w2H4VXEN7cU-R-NOuVkSyMXyAbVmajL0X9rXxNxgtux75JvShwTSX2uwiCDgJzfV25EDIeOuv5yxdIcRZoSyNimWzlP-E2tIUB4FBYIbAesDE6VcJwTMV3q-BvOVxnTrocjwclzsCpfF4Iwy8Th7au0AkKNmadKFAnPLeasI-PT9YcRxuaPD5K9WR-mREvgzdo15kqUAAYhCQZ-48zCAbQ7Dsdip8EgD7fYJRvZwqnnZ_v4BrZvKSk9EwDa7dQBUZhAc5emwgEZk7lnFWlmaxWrAJxPAmb4k5Muf2LxDxcFAvI-2_hk7H9yhMndnSHeEjKQfE-j20anrMjrLQgLVmcCuNiF_caGHb1BHXGkDWzi0HuvQOcpeMjJ4qqBxeOmF-g6Ygyz98xU4sPRMMiLNxNFz-tvvIIO5U6jtPr663TcreBOMYfIExaO8uyuy6cJT0h-OUSakMj908J64nnpT0pgDWCIoYPq3WiFgM8-G46wg-YQ2CEsaTSmjcxnKmQv310YQec1AXj5HzCP1BNVrRI64WGqSyXq05AEEn-bBzPmQlhDDjxsjOrsWNb4TuHXzissnfB3Zo_4kGeyUJUgluFVNbwWziMErUinEev5zD7qo_8kVZATgAAtH0ZJAv7veKgPyjEc-3uEffDoptU_3GlDnaR5nfd6HDIIwwrdk4NsTNlKvkqEChT2N8EGF81kN6lOLvQJodjyF6fzPzDsIUK9AVzZRLf8QYmjrYCUizDYU26Yuv7uGf0XlQUibFi5j-0-Pnntd6VE-tyz-dyClbIoI_HYtY9JJTH2HkHCbtypL-5hitpFivIHv9zLRbyQxepvKbGT9Zf3pO0ypItzOdzrogDn9VzrRaE5nTaUHKvl4QU78u4DzDyr7ugVuQx7JyaVJHHXWAxa_ZSEJX37MXlMQ6EVkL3KSUDJmGsNzHZzgq-We4v4HaYRV8tz3uJcPaDNfgymxQwVyVlmvEn77Npt8LR3Flku5gyfWaUKSw3uNw7m00)

### Notas rápidas
- Paginação: aplicar em listagens futuras (ex.: histórico de receitas).
- Testes: usar mocks para DB e simulador (JUnit 5 + Mockito).
- Camadas seguem ADR 0007 (DDD lite em camadas).
- Para gerar as imagens, copie cada bloco de código PlantUML e cole em [plantuml.com/plantuml](https://www.plantuml.com/plantuml) ou use um servidor PlantUML local.
